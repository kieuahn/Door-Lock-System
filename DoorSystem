#include <Keypad.h>
#include <AccelStepper.h>

// Motor set-up
#define motorPin1  8 //IN1    
#define motorPin2  9  //IN2 
#define motorPin3  10 //IN3   
#define motorPin4  11 //IN4    
#define MotorInterfaceType 4 //FULL4WRIRE

AccelStepper stepper = AccelStepper(MotorInterfaceType, motorPin1, motorPin3, motorPin2, motorPin4);


//Keypad set-up
#define Pass_length 7
char Pass_entered[Pass_length];
char Password[Pass_length] = {"123456"};
byte Pass_counted = 0;
bool door_state = true;
const byte ROWS = 4;
const byte COLS = 4;
char key_entered;
char hexaKeys[ROWS][COLS] = {
  {'1', '2', '3', 'A'},
  {'4', '5', '6', 'B'},
  {'7', '8', '9', 'C'},
  {'*', '0', '#', 'D'}
};

byte rowPins[ROWS] = {9, 8, 7, 6};
byte colPins[COLS] = {5, 4, 3, 2};

Keypad customKeypad = Keypad(makeKeymap(hexaKeys), rowPins, colPins, ROWS, COLS);

void Reset() {
  while (Pass_entered != NULL) {
    Pass_entered[Pass_counted--] = 0;
  }
  return;
}

void Open() {
  Serial.println("Enter your password:");
  key_entered = customKeypad.getKey();

  //if key is pressed then add the key into the array password for after comparison
  if (key_entered != NO_KEY) {
     Serial.println(key_entered);
    Pass_entered[Pass_counted] = key_entered;
    //keep track of the "pass_entered" array's length and store new value
    Pass_counted++;
    
  }
  delay(100);
for (int i = 0; i<Pass_length; i++) {
      Serial.println(Pass_entered[Pass_counted]);
      }
  //Array of key entered is being compared below
  if (Pass_counted == Pass_length - 1) {
    if (strcmp(Pass_entered, Password) == 0) {
      Serial.println("Door open!");
      
      door_state = 0;
    } else {
      Serial.println("Wrong password!");
      Reset();
    }
  }

}

void Close() {
  Serial.println("Press C to close the door");
  key_entered = customKeypad.getKey();
  if (key_entered != NO_KEY) {
    Serial.println(key_entered);
    if (key_entered == "C") {
      Serial.println("Door closed!");
      
      door_state = 1;
    } else {
      Serial.println("Wrong button!");
    }
  } else {
    key_entered == "";
  }
}
void setup() {
  // put your setup code here, to run once:

  Serial.begin(9600);
  
}

void loop() {
  // put your main code here, to run repeatedly:
  door_state = 0;
  if (door_state = 0) {
    Close();
  }

}